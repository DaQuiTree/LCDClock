C51 COMPILER V8.08   DHT11                                                                 05/29/2017 18:18:30 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN ..\output\DHT11.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\source\DHT11.c BROWSE DEBUG OBJECTEXTEND PRINT(.\DHT11.lst) OBJECT(..\ou
                    -tput\DHT11.obj)

line level    source

   1          #define _DHT11_C
   2          #include "config.h"
   3          #include "dht11.h"
   4          
   5          void DelayX10us(uint16 x)
   6          {
   7   1              
   8   1              do{
   9   2                      _nop_();
  10   2                      _nop_();
  11   2              }while(--x);    
  12   1      }
  13          
  14          bit DHT11GetACK()
  15          {
  16   1              bit ack;
  17   1      
  18   1              DHT11_DATA = 0;
  19   1              DelayX10us(2000);//延时20ms
  20   1              DHT11_DATA = 1;                                                            
  21   1              DelayX10us(4);
  22   1              ack = DHT11_DATA;
  23   1              
  24   1              return ~ack;    
  25   1      }
  26          
  27          
  28          bit DHT11GetData(uint8* humi, uint8* temp) 
  29          {
  30   1              bit ack;
  31   1              uint8 cnt = 32;
  32   1              uint32 mdat = 0;
  33   1      
  34   1              ack = DHT11GetACK();
  35   1              if(!ack)return ack;  //读数失败
  36   1              while(!DHT11_DATA);       //等待DHT11拉高电平
  37   1              DelayX10us(8);  
  38   1      
  39   1              while(cnt--){
  40   2                      while(!DHT11_DATA);     //等待高电平到来                  
  41   2                      TL1 = 0;
  42   2                      TR1 = 1;
  43   2                      while(DHT11_DATA);      //等待高电平结束
  44   2                      TR1 = 0;                        //结束计时
  45   2                      if(TL1 < 30){  //低电平
  46   3                              mdat <<= 1; 
  47   3                      }else{                  //高电平
  48   3                              mdat <<= 1;
  49   3                              mdat |= 0x1;
  50   3                      }               
  51   2              }
  52   1      
  53   1              *humi = (uint8)(mdat >> 24);
  54   1              *temp = (uint8)(mdat >> 8);
C51 COMPILER V8.08   DHT11                                                                 05/29/2017 18:18:30 PAGE 2   

  55   1              return 1;       
  56   1      }
  57          
  58          void ConfigureDHT11()
  59          {
  60   1              TMOD &= 0x0F;
  61   1              TMOD |= 0x10;
  62   1      
  63   1              ET1 = 0;
  64   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    213    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
