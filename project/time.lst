C51 COMPILER V8.08   TIME                                                                  05/29/2017 16:06:47 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN ..\output\time.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\source\time.c BROWSE DEBUG OBJECTEXTEND PRINT(.\time.lst) OBJECT(..\outp
                    -ut\time.obj)

line level    source

   1          #include "config.h"
   2          #include "ds1302.h"
   3          #include "lcd12864.h"
   4          #include "lunar.h"
   5          #include "DHT11.h"
   6          
   7          uint16 code weekCN[8][2] = {
   8                  {0x0000,0x0000},{0xD6DC,0xD2BB},
   9                  {0xD6DC,0xB6FE},{0xD6DC,0xC8FD},
  10                  {0xD6DC,0xCBC4},{0xD6DC,0xCEE5},
  11                  {0xD6DC,0xC1F9},{0xD6DC,0xC8D5}
  12          };      /*空、周一~周日*/
  13          
  14          void ShowCurrentTime()
  15          {
  16   1              static uint8 pSec = 0xAA;
  17   1              static uint8 pDay = 0xAA;
  18   1              static uint8 pHour = 0xAA;
  19   1              static bit bDay = 0;
  20   1              uint16 pdata tStr[8];
  21   1              uint8  pdata dStr[16];
  22   1              uint16 pdata dSplit;
  23   1      
  24   1              DS1302BurstRead(&timeMod); 
  25   1              if(pSec != timeMod.sec)
  26   1              {
  27   2                      pSec = timeMod.sec;
  28   2                      tStr[0] = (timeMod.hour >> 4) + 0xA3B0; //时高
  29   2                      tStr[1] = (timeMod.hour & 0x0F) + 0xA3B0;//时低
  30   2                      tStr[2] = 0xA1C3;//时间分隔符
  31   2                      tStr[3] = (timeMod.min >> 4) + 0xA3B0;  //分高
  32   2                      tStr[4] = (timeMod.min & 0x0F) + 0xA3B0;//分低
  33   2                      tStr[5] = 0xA1C3;//时间分隔符
  34   2                      tStr[6] = (timeMod.sec >> 4) + 0xA3B0;  //秒高
  35   2                      tStr[7] = (timeMod.sec & 0x0F) + 0xA3B0;//秒低 
  36   2                      LCDShowCN(0,3,tStr,8);//液晶第1行显示日期时间
  37   2                      if(pHour != timeMod.hour){
  38   3                              pHour = timeMod.hour;
  39   3                              if(timeMod.hour >= 0x08 && timeMod.hour <= 0x18)        //若在白天，显示太阳图标
  40   3                              {
  41   4                                      if(!bDay)
  42   4                                      {
  43   5                                              bDay = ~bDay;
  44   5                                              LCDDrawArea(5,0,sunImage);
  45   5                                      }
  46   4                              }else{    //若在黑夜，显示月亮图标
  47   4                                      if(!bDay)
  48   4                                      {
  49   5                                              bDay = ~bDay;
  50   5                                              LCDDrawArea(5,0,sunImage);
  51   5                                      }
  52   4                              }
  53   3                      }
  54   2              }
C51 COMPILER V8.08   TIME                                                                  05/29/2017 16:06:47 PAGE 2   

  55   1      
  56   1              if(pDay != timeMod.day) //若日期改变了
  57   1              {
  58   2                      pDay = timeMod.day;       //更新日期
  59   2                      dStr[0] = ' ';
  60   2                      dStr[1] = ' ';
  61   2                      dStr[2] = '2';
  62   2                      dStr[3] = '0';
  63   2                      dStr[4] = (timeMod.year >> 4) + '0';    //年高
  64   2                      dStr[5] = (timeMod.year & 0x0F) + '0';//年低
  65   2                      dStr[6] = ' ';
  66   2                      dStr[7] = ' ';
  67   2                      dStr[8] = (timeMod.month >> 4) + '0';   //月高
  68   2                      dStr[9] = (timeMod.month & 0x0F) + '0';//月低
  69   2                      dStr[10] = ' ';
  70   2                      dStr[11] = ' ';
  71   2                      dStr[12] = (timeMod.day >> 4) + '0';    //日高
  72   2                      dStr[13] = (timeMod.day & 0x0F) + '0';//日低
  73   2                      dSplit = 0xA1A4;
  74   2      
  75   2                      LCDShowStr(0,1,dStr,14);//液晶第2行显示日期时间
  76   2                      LCDShowCN(3,1,&dSplit,1);
  77   2                      LCDShowCN(5,1,&dSplit,1);       //显示日期分隔符
  78   2                      LCDShowCN(3,2,weekCN[timeMod.week],2);  //液晶第3行显示星期
  79   2      
  80   2               /*     uint16 lunar[7];
  81   2              uint8  lunarLen, lday, lyear, lmonth;*/
  82   2              /*      lyear = (timeMod.year >> 4) * 10 + (timeMod.year & 0x0F);
  83   2                      lmonth = (timeMod.month >> 4) * 10 + (timeMod.month & 0x0F);
  84   2                      lday = (timeMod.day >> 4) * 10 + (timeMod.day & 0x0F); 
  85   2                      lunarLen = GetLunarDate(lyear, lmonth, lday, lunar);
  86   2                      LCDShowCN(1,2,lunar,lunarLen);  */
  87   2              }  
  88   1      }
  89          
  90          void ShowTemp()
  91          {
  92   1              uint8 temp,humi;
  93   1              uint8 dat[16] = "  30    45%RH   ";
  94   1              uint16 symbol = 0xA1E6;
  95   1      
  96   1              DHT11GetData(&humi, &temp);
  97   1              dat[2] = temp/10 + '0';
  98   1              dat[3] = temp%10 + '0';
  99   1              dat[8] = humi/10 + '0';
 100   1              dat[9] = humi%10 + '0';
 101   1      
 102   1              LCDShowStr(0,3,dat,16);
 103   1              LCDShowCN(2,3,&symbol,1);
 104   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    481    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----      34
   DATA SIZE        =      3      20
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
