C51 COMPILER V8.08   TIME                                                                  05/30/2017 18:02:54 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN ..\output\time.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\source\time.c BROWSE DEBUG OBJECTEXTEND PRINT(.\time.lst) OBJECT(..\outp
                    -ut\time.obj)

line level    source

   1          #define _TIME_C
   2          #include "config.h"
   3          #include "ds1302.h"
   4          #include "lcd12864.h"
   5          #include "lunar.h"
   6          #include "DHT11.h"
   7          #include "keyboard.h"
   8          #include "main.h"
   9          
  10          uint8 pSec = 0xAA;
  11          uint8 pDay = 0xAA;
  12          uint8 pHour = 0xAA;
  13          
  14          uint16 code weekCN[8][2] = {
  15                  {0x0000,0x0000},{0xD6DC,0xD2BB},
  16                  {0xD6DC,0xB6FE},{0xD6DC,0xC8FD},
  17                  {0xD6DC,0xCBC4},{0xD6DC,0xCEE5},
  18                  {0xD6DC,0xC1F9},{0xD6DC,0xC8D5}
  19          };      /*空、周一~周日*/
  20          
  21          void ClearInforArea()  //清空屏幕下三行,保留标题栏
  22          {
  23   1              uint8 i;
  24   1      
  25   1              for(i = 0; i < 3; i++)
  26   1              {
  27   2                      LCDClearArea(0,i+1);
  28   2              }
  29   1      }
  30          
  31          void ShowCurrentTime()
  32          {
  33   1              uint16 pdata tStr[8];
  34   1              uint8  pdata dStr[16];
  35   1              uint16 pdata dSplit;
  36   1      
  37   1              DS1302BurstRead(&timeMod); 
  38   1              if(pSec != timeMod.sec)
  39   1              {
  40   2                      pSec = timeMod.sec;
  41   2                      tStr[0] = (timeMod.hour >> 4) + 0xA3B0; //时高
  42   2                      tStr[1] = (timeMod.hour & 0x0F) + 0xA3B0;//时低
  43   2                      tStr[2] = 0xA1C3;//时间分隔符
  44   2                      tStr[3] = (timeMod.min >> 4) + 0xA3B0;  //分高
  45   2                      tStr[4] = (timeMod.min & 0x0F) + 0xA3B0;//分低
  46   2                      tStr[5] = 0xA1C3;//时间分隔符
  47   2                      tStr[6] = (timeMod.sec >> 4) + 0xA3B0;  //秒高
  48   2                      tStr[7] = (timeMod.sec & 0x0F) + 0xA3B0;//秒低 
  49   2                      LCDShowCN(0,3,tStr,8);//液晶第1行显示日期时间
  50   2                      if(pHour != timeMod.hour){
  51   3                              pHour = timeMod.hour;
  52   3                              if(timeMod.hour >= 0x08 && timeMod.hour <= 0x18)        //若在白天，显示太阳图标
  53   3                              {
  54   4                                      LCDDrawArea(5,0,sunImage);
C51 COMPILER V8.08   TIME                                                                  05/30/2017 18:02:54 PAGE 2   

  55   4                              }else{    //若在黑夜，显示月亮图标
  56   4                                      LCDDrawArea(5,0,sunImage);
  57   4                              }
  58   3                      }
  59   2              }
  60   1      
  61   1              if(pDay != timeMod.day) //若日期改变了
  62   1              {
  63   2                      pDay = timeMod.day;       //更新日期
  64   2                      dStr[0] = ' ';
  65   2                      dStr[1] = ' ';
  66   2                      dStr[2] = '2';
  67   2                      dStr[3] = '0';
  68   2                      dStr[4] = (timeMod.year >> 4) + '0';    //年高
  69   2                      dStr[5] = (timeMod.year & 0x0F) + '0';//年低
  70   2                      dStr[6] = ' ';
  71   2                      dStr[7] = ' ';
  72   2                      dStr[8] = (timeMod.month >> 4) + '0';   //月高
  73   2                      dStr[9] = (timeMod.month & 0x0F) + '0';//月低
  74   2                      dStr[10] = ' ';
  75   2                      dStr[11] = ' ';
  76   2                      dStr[12] = (timeMod.day >> 4) + '0';    //日高
  77   2                      dStr[13] = (timeMod.day & 0x0F) + '0';//日低
  78   2                      dSplit = 0xA1A4;
  79   2      
  80   2                      LCDShowStr(0,1,dStr,14);//液晶第2行显示日期时间
  81   2                      LCDShowCN(3,1,&dSplit,1);
  82   2                      LCDShowCN(5,1,&dSplit,1);       //显示日期分隔符
  83   2                      LCDShowCN(3,2,weekCN[timeMod.week],2);  //液晶第3行显示星期
  84   2      
  85   2              }  
  86   1      }
  87          
  88          void ShowTemp()
  89          {
  90   1              uint8 temp,humi;
  91   1              uint16 dat[3];
  92   1      
  93   1              DHT11GetData(&humi, &temp);
  94   1              
  95   1              dat[0] = temp/10 + 0xA3B0;
  96   1              dat[1] = temp%10 + 0xA3B0;
  97   1              dat[2] = 0xA1E6; 
  98   1              LCDShowCN(3,1,dat,3);  //温度
  99   1      
 100   1              dat[0] = humi/10 + 0xA3B0;
 101   1              dat[1] = humi%10 + 0xA3B0;
 102   1              dat[2] = 0xA3A5; 
 103   1              LCDShowCN(3,2,dat,3);  //湿度
 104   1      }
 105          
 106          void ShowInfo()
 107          {
 108   1              uint16 pdata lunar[7];
 109   1              uint8 pdata lunarLen, lday, lyear, lmonth;
 110   1              uint16 code iPrompt[3][3] ={
 111   1                      {0xCEC2,0xB6C8,0xA3BA},
 112   1                      {0xCAAA,0xB6C8,0xA3BA},
 113   1                      {0xC4D6,0xD6D3,0xA3BA}
 114   1              };
 115   1              
 116   1              LCDClearAll();    //清除显示区域
C51 COMPILER V8.08   TIME                                                                  05/30/2017 18:02:54 PAGE 3   

 117   1              LCDShowCN(0,1,iPrompt[0],3);  //p温度：
 118   1              LCDShowCN(0,2,iPrompt[1],3);  //p湿度：
 119   1              LCDShowCN(0,3,iPrompt[2],3);  //p闹钟：
 120   1              ShowTemp();                                //显示数值
 121   1              lyear = (timeMod.year >> 4) * 10 + (timeMod.year & 0x0F);
 122   1              lmonth = (timeMod.month >> 4) * 10 + (timeMod.month & 0x0F);
 123   1              lday = (timeMod.day >> 4) * 10 + (timeMod.day & 0x0F); 
 124   1              lunarLen = GetLunarDate(lyear, lmonth, lday, lunar);
 125   1              LCDShowCN(1,0,lunar,lunarLen);
 126   1      }
 127          
 128          void KeyAction(uint8 keyCode)
 129          {
 130   1              if(keyCode == 0x0D)//回车
 131   1              {
 132   2                      mMode++;
 133   2                      mMode &= 0x01;//改变mMode状态
 134   2                      if(mMode == ReadDate){
 135   3                              LCDClearAll();  //清屏
 136   3                              pSec = 0xAA;    //强制显示时间
 137   3                              pDay = 0xAA;
 138   3                              pHour = 0xAA;
 139   3                      }else if(mMode == ReadInfo){
 140   3                              ShowInfo();
 141   3                      }
 142   2              }else if(keyCode == 0x1B){//取消
 143   2      
 144   2              }else if(keyCode == 0x26){//向上
 145   2      
 146   2              }else if(keyCode == 0xD0){
 147   2                              LCDClearAll();  //清屏
 148   2                              LCDShowStr(0,0,"OK!",3);        
 149   2              }
 150   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    719    ----
   CONSTANT SIZE    =     54    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----      52
   DATA SIZE        =      3      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
