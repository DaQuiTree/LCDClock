C51 COMPILER V8.08   TIME                                                                  05/31/2017 08:27:18 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN ..\output\time.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ..\source\time.c BROWSE DEBUG OBJECTEXTEND PRINT(.\time.lst) OBJECT(..\outp
                    -ut\time.obj)

line level    source

   1          #define _TIME_C
   2          #include "config.h"
   3          #include "ds1302.h"
   4          #include "lcd12864.h"
   5          #include "lunar.h"
   6          #include "DHT11.h"
   7          #include "keyboard.h"
   8          #include "main.h"
   9          
  10          uint8 pSec = 0xAA;
  11          uint8 pDay = 0xAA;
  12          uint8 pHour = 0xAA; //时钟的初始值
  13          
  14          uint8 cHour = 0x00;
  15          uint8 cMin = 0x00; //闹钟初始值
  16          
  17          uint16 code weekCN[8][2] = {
  18                  {0x0000,0x0000},{0xD6DC,0xD2BB},
  19                  {0xD6DC,0xB6FE},{0xD6DC,0xC8FD},
  20                  {0xD6DC,0xCBC4},{0xD6DC,0xCEE5},
  21                  {0xD6DC,0xC1F9},{0xD6DC,0xC8D5}
  22          };      /*空、周一~周日*/
  23          
  24          void ClearInforArea()  //清空屏幕下三行,保留标题栏
  25          {
  26   1              uint8 i;
  27   1      
  28   1              for(i = 0; i < 3; i++)
  29   1              {
  30   2                      LCDClearArea(0,i+1);
  31   2              }
  32   1      }
  33          
  34          void ShowCurrentTime()
  35          {
  36   1              uint16 pdata tStr[8];
  37   1              uint8  pdata dStr[16];
  38   1              uint16 pdata dSplit;
  39   1      
  40   1              DS1302BurstRead(&timeMod); 
  41   1              if(pSec != timeMod.sec)
  42   1              {
  43   2                      pSec = timeMod.sec;
  44   2                      tStr[0] = (timeMod.hour >> 4) + 0xA3B0; //时高
  45   2                      tStr[1] = (timeMod.hour & 0x0F) + 0xA3B0;//时低
  46   2                      tStr[2] = 0xA1C3;//时间分隔符
  47   2                      tStr[3] = (timeMod.min >> 4) + 0xA3B0;  //分高
  48   2                      tStr[4] = (timeMod.min & 0x0F) + 0xA3B0;//分低
  49   2                      tStr[5] = 0xA1C3;//时间分隔符
  50   2                      tStr[6] = (timeMod.sec >> 4) + 0xA3B0;  //秒高
  51   2                      tStr[7] = (timeMod.sec & 0x0F) + 0xA3B0;//秒低 
  52   2                      LCDShowCN(0,3,tStr,8);//液晶第1行显示日期时间
  53   2                      if(pHour != timeMod.hour){
  54   3                              pHour = timeMod.hour;
C51 COMPILER V8.08   TIME                                                                  05/31/2017 08:27:18 PAGE 2   

  55   3                              if(timeMod.hour >= 0x08 && timeMod.hour <= 0x18)        //若在白天，显示太阳图标
  56   3                              {
  57   4                                      LCDDrawArea(5,0,sunImage);
  58   4                              }else{    //若在黑夜，显示月亮图标
  59   4                                      LCDDrawArea(5,0,sunImage);
  60   4                              }
  61   3                      }
  62   2              }
  63   1      
  64   1              if(pDay != timeMod.day) //若日期改变了
  65   1              {
  66   2                      pDay = timeMod.day;       //更新日期
  67   2                      dStr[0] = ' ';
  68   2                      dStr[1] = ' ';
  69   2                      dStr[2] = '2';
  70   2                      dStr[3] = '0';
  71   2                      dStr[4] = (timeMod.year >> 4) + '0';    //年高
  72   2                      dStr[5] = (timeMod.year & 0x0F) + '0';//年低
  73   2                      dStr[6] = ' ';
  74   2                      dStr[7] = ' ';
  75   2                      dStr[8] = (timeMod.month >> 4) + '0';   //月高
  76   2                      dStr[9] = (timeMod.month & 0x0F) + '0';//月低
  77   2                      dStr[10] = ' ';
  78   2                      dStr[11] = ' ';
  79   2                      dStr[12] = (timeMod.day >> 4) + '0';    //日高
  80   2                      dStr[13] = (timeMod.day & 0x0F) + '0';//日低
  81   2                      dSplit = 0xA1A4;
  82   2      
  83   2                      LCDShowStr(0,1,dStr,14);//液晶第2行显示日期时间
  84   2                      LCDShowCN(3,1,&dSplit,1);
  85   2                      LCDShowCN(5,1,&dSplit,1);       //显示日期分隔符
  86   2                      LCDShowCN(3,2,weekCN[timeMod.week],2);  //液晶第3行显示星期
  87   2      
  88   2              }  
  89   1      }
  90          
  91          void ShowTemp()
  92          {
  93   1              uint8 temp,humi;
  94   1              uint16 dat[3];
  95   1      
  96   1              DHT11GetData(&humi, &temp);
  97   1              
  98   1              dat[0] = temp/10 + 0xA3B0;
  99   1              dat[1] = temp%10 + 0xA3B0;
 100   1              dat[2] = 0xA1E6; 
 101   1              LCDShowCN(3,1,dat,3);  //温度
 102   1      
 103   1              dat[0] = humi/10 + 0xA3B0;
 104   1              dat[1] = humi%10 + 0xA3B0;
 105   1              dat[2] = 0xA3A5; 
 106   1              LCDShowCN(3,2,dat,3);  //湿度
 107   1      }
 108          
 109          void ShowInfo()
 110          {
 111   1              uint16 pdata lunar[7];
 112   1              uint8 pdata lunarLen, lday, lyear, lmonth;
 113   1              uint16 code iPrompt[3][3] ={
 114   1                      {0xCEC2,0xB6C8,0xA3BA},
 115   1                      {0xCAAA,0xB6C8,0xA3BA},
 116   1                      {0xC4D6,0xD6D3,0xA3BA}
C51 COMPILER V8.08   TIME                                                                  05/31/2017 08:27:18 PAGE 3   

 117   1              };
 118   1              
 119   1              LCDClearAll();    //清除显示区域
 120   1              LCDShowCN(0,1,iPrompt[0],3);  //p温度：
 121   1              LCDShowCN(0,2,iPrompt[1],3);  //p湿度：
 122   1              LCDShowCN(0,3,iPrompt[2],3);  //p闹钟：
 123   1              ShowTemp();                                //显示数值
 124   1              lyear = (timeMod.year >> 4) * 10 + (timeMod.year & 0x0F);
 125   1              lmonth = (timeMod.month >> 4) * 10 + (timeMod.month & 0x0F);
 126   1              lday = (timeMod.day >> 4) * 10 + (timeMod.day & 0x0F); 
 127   1              lunarLen = GetLunarDate(lyear, lmonth, lday, lunar);
 128   1              LCDShowCN(1,0,lunar,lunarLen);
 129   1      }
 130          
 131          void KeyAction(uint8 keyCode)
 132          {
 133   1              if(keyCode == 0x0D)//按回车键进入设定状态
 134   1              {
 135   2                      uint16 pdata clockStr[5];
 136   2      
 137   2                      if(mMode == SetDate){
 138   3                              mMode = SetClock;
 139   3                              LCDClearAll();
 140   3                              LCDShowCN(0,0,"闹钟设定：",5);
*** WARNING C182 IN LINE 140 OF ..\SOURCE\TIME.C: pointer to different objects
 141   3                              clockStr[0] = (cHour >> 4) + 0xA3B0;
 142   3                              clockStr[1] = (cHour & 0x0F) + 0xA3B0;
 143   3                              clockStr[2] = 0xA1C3;
 144   3                              clockStr[3] = (cMin >> 4) + 0xA3B0;
 145   3                              clockStr[4] = (cMin & 0x0F) + 0xA3B0;
 146   3                              LCDShowCN(2,2,clockStr,5);
 147   3                              LCDSetCursor(2,3);
 148   3                              LCDShowCursor();
 149   3                      }else{
 150   3                              mMode = SetDate;
 151   3                              LCDClearAll();
 152   3                              LCDShowCN(0,0,"调整时钟：",5);
*** WARNING C182 IN LINE 152 OF ..\SOURCE\TIME.C: pointer to different objects
 153   3                              pSec = 0xAA;
 154   3                              pDay = 0xAA; //强制刷新时间界面（不刷新太阳月亮图标）
 155   3                              ShowCurrentTime();
 156   3                              LCDSetCursor(2,1);
 157   3                              LCDShowCursor();
 158   3                              
 159   3                      }
 160   2              }else if(keyCode == 0x1B){//取消
 161   2      
 162   2              }else if(keyCode == 0x26){//向上
 163   2      
 164   2              }else if(keyCode == 0x27){//向上、翻页
 165   2                      if(mMode < SetDate) //处于信息展示状态时翻页
 166   2                      {
 167   3                              mMode++;
 168   3                              mMode &= 0x01;//改变mMode状态
 169   3                              if(mMode == ReadDate){ //时间界面
 170   4                                      LCDClearAll();  //清屏
 171   4                                      pSec = 0xAA;    //强制显示时间
 172   4                                      pDay = 0xAA;
 173   4                                      pHour = 0xAA;
 174   4                              }else if(mMode == ReadInfo){//温度等信息界面
 175   4                                      ShowInfo();
 176   4                              }
C51 COMPILER V8.08   TIME                                                                  05/31/2017 08:27:18 PAGE 4   

 177   3                      }else{
 178   3                              
 179   3                      }               
 180   2              }
 181   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    865    ----
   CONSTANT SIZE    =     72    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----      62
   DATA SIZE        =      5      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
